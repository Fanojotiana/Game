<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>üêç Petit Serpent et Pommes üçé</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.90.0/phaser.min.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Fredoka", Arial, sans-serif;
        text-align: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        background-size: cover;
        background-image:url(https://wallpapercave.com/wp/wp3906251.jpg) ;
      
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      .game-container {
        position: relative;
        display: inline-block;
        
      }

      h1 {
        color: #fff;
        font-size: 3.5em;
        font-weight: 700;
        text-shadow: 3px 3px 0px rgba(0, 0, 0, 0.2),
          5px 5px 20px rgba(255, 255, 255, 0.3),
          -2px -2px 10px rgba(147, 51, 234, 0.5);
        margin-bottom: 20px;
        letter-spacing: 2px;
        animation: titleFloat 3s ease-in-out infinite;
      }

      @keyframes titleFloat {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
      }

      canvas {
        display: block;
        margin: 0 auto;
        border: 6px solid rgba(255, 255, 255, 0.3);
    
        border-radius: 30px;
        background: linear-gradient(135deg, rgba(26, 26, 46, 0.6) 0%, rgba(22, 33, 62, 0.6) 100%);
        transition: transform 0.3s ease;
      }

      canvas:hover {
        transform: scale(1.01);
      }


      .instructions {
        color: #fff;
        font-size: 1.1em;
        margin-top: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        background: rgba(255, 255, 255, 0.1);
        padding: 15px 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        display: inline-block;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 10px;
      }

      .key {
        background: rgba(255, 255, 255, 0.2);
        color: #fff;
        padding: 8px 15px;
        border-radius: 8px;
        font-weight: 600;
        backdrop-filter: blur(5px);
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
      }

      .emoji {
        display: inline-block;
        animation: float 2s ease-in-out infinite;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>üêç Petit Serpent et Pommes üçé</h1>
      <canvas id="game-canvas"></canvas>
      <div class="instructions">
        <div>
          <span class="emoji">üéÆ</span> Utilisez les fl√®ches pour diriger votre serpent
        </div>
        <div class="controls">
          <span class="key">‚Üê</span>
          <span class="key">‚Üë</span>
          <span class="key">‚Üì</span>
          <span class="key">‚Üí</span>
          <span class="key">P (Pause)</span>
        </div>
        <div style="margin-top: 10px">
          <span class="emoji">üçé</span> Mangez des pommes pour grandir !
          <span class="emoji">‚ö†Ô∏è</span> √âvitez les serpents ennemis !
        </div>
      </div>
    </div>

    <script>
      const config = {
        type: Phaser.CANVAS,
        width: 800,
        height: 600,
        canvas: document.getElementById("game-canvas"),
        scene: {
          preload: preload,
          create: create,
          update: update
        }
      };

      const game = new Phaser.Game(config);
      let gameStarted = false;
      let isPaused = false;
      let bgMusic, eatSound, dieSound, startSound;

      function preload() {
        // Charger les sons (utilisation de sons g√©n√©r√©s ou placeholder)
        // Pour un vrai jeu, remplacez ces URLs par vos vrais fichiers audio
        this.load.audio('bgMusic', ['https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3']);
        this.load.audio('eatSound', ['https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3']);
        this.load.audio('dieSound', ['https://assets.mixkit.co/active_storage/sfx/2026/2026-preview.mp3']);
        this.load.audio('startSound', ['https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3']);
        
        this.playerColor = 0x0000ff;
        this.snakeColors = [0x00ff88, 0x00ffff, 0xff00ff];
      }

      function create() {
        // Initialiser les sons
        bgMusic = this.sound.add('bgMusic', { loop: true, volume: 0.3 });
        eatSound = this.sound.add('eatSound', { volume: 0.5 });
        dieSound = this.sound.add('dieSound', { volume: 0.6 });
        startSound = this.sound.add('startSound', { volume: 0.5 });

        // Fond avec gradient
        const graphics = this.add.graphics();
        graphics.fillGradientStyle(0x1a1a2e, 0x16213e, 0x0f3460, 0x533483, 1);
        graphics.fillRect(0, 0, 800, 600);
        graphics.setDepth(-2);

        // Particules d'√©toiles
        this.stars = [];
        for (let i = 0; i < 80; i++) {
          const star = this.add.circle(
            Phaser.Math.Between(0, 800),
            Phaser.Math.Between(0, 600),
            Phaser.Math.Between(1, 3),
            0xffffff,
            Phaser.Math.FloatBetween(0.3, 0.9)
          );
          star.setDepth(-1);
          this.stars.push(star);

          this.tweens.add({
            targets: star,
            alpha: 0.2,
            duration: Phaser.Math.Between(1000, 3000),
            yoyo: true,
            repeat: -1
          });
        }

        // Serpent joueur (cach√© au d√©part)
        this.playerSnake = [];
        for (let i = 0; i < 3; i++) {
          const segShadow = this.add.ellipse(400 - i * 25, 305, 28, 10, 0x000000, 0.3);
          segShadow.setDepth(0);
          segShadow.setVisible(false);

          const seg = this.add.rectangle(400 - i * 25, 300, 25, 25, this.playerColor);
          seg.setDepth(1);
          seg.setStrokeStyle(2, 0xffffff, 0.5);
          seg.shadow = segShadow;
          seg.setVisible(false);

          this.playerSnake.push(seg);
        }

        this.playerDirection = { x: 1, y: 0 };
        this.nextDirection = { x: 1, y: 0 };
        this.moveTimer = 0;
        this.cursors = this.input.keyboard.createCursorKeys();
        this.segmentSize = 25;

        // Score
        this.score = 0;
        this.scoreText = this.add.text(20, 20, "Score: 0", {
          fontSize: "32px",
          fill: "#ffffff",
          fontFamily: "Fredoka, Arial",
          fontStyle: "bold",
          stroke: "#000",
          strokeThickness: 4,
          shadow: { offsetX: 3, offsetY: 3, color: "#000", blur: 5, fill: true }
        });
        this.scoreText.setDepth(100);
        this.scoreText.setVisible(false);

        // Barre de progression
        this.progressBar = this.add.rectangle(400, 30, 0, 15, 0x00ff88);
        this.progressBar.setDepth(99);
        this.progressBar.setVisible(false);
        
        this.progressBg = this.add.rectangle(400, 30, 200, 15, 0x333333, 0.5);
        this.progressBg.setDepth(98);
        this.progressBg.setVisible(false);

        // Bouton Pause (cach√© au d√©part)
        this.pauseButton = this.add.text(750, 20, "‚è∏", {
          fontSize: "32px",
          fill: "#ffffff",
          fontFamily: "Arial"
        });
        this.pauseButton.setDepth(100);
        this.pauseButton.setInteractive({ useHandCursor: true });
        this.pauseButton.setVisible(false);
        
        this.pauseButton.on('pointerdown', () => {
          this.togglePause();
        });

        // Touche P pour pause
        this.input.keyboard.on('keydown-P', () => {
          if (gameStarted) this.togglePause();
        });

        this.winText = null;
        this.appleGroup = this.add.group();
        this.snakes = [];

        // √âCRAN DE D√âMARRAGE
        this.startOverlay = this.add.rectangle(400, 300, 800, 600, 0x000000, 0.8);
        this.startOverlay.setDepth(150);

        this.startTitle = this.add.text(400, 200, "üêç SNAKE GAME üçé", {
          fontSize: "72px",
          fill: "#00ff88",
          fontFamily: "Fredoka, Arial",
          fontStyle: "bold",
          stroke: "#000",
          strokeThickness: 6,
          shadow: { offsetX: 4, offsetY: 4, color: "#000", blur: 10, fill: true }
        }).setOrigin(0.5);
        this.startTitle.setDepth(151);

        // Animation du titre
        this.tweens.add({
          targets: this.startTitle,
          scaleX: 1.1,
          scaleY: 1.1,
          duration: 1000,
          yoyo: true,
          repeat: -1
        });

        // Bouton Commencer
        const startBg = this.add.rectangle(400, 350, 280, 80, 0x00ff88);
        startBg.setDepth(151);
        startBg.setStrokeStyle(4, 0xffffff);
        startBg.setInteractive({ useHandCursor: true });

        const startText = this.add.text(400, 350, "‚ñ∂ COMMENCER", {
          fontSize: "36px",
          fill: "#000000",
          fontFamily: "Fredoka, Arial",
          fontStyle: "bold"
        }).setOrigin(0.5);
        startText.setDepth(152);

        // Effet hover
        startBg.on('pointerover', () => {
          startBg.setFillStyle(0x00ffaa);
          this.tweens.add({
            targets: [startBg, startText],
            scaleX: 1.1,
            scaleY: 1.1,
            duration: 200
          });
        });

        startBg.on('pointerout', () => {
          startBg.setFillStyle(0x00ff88);
          this.tweens.add({
            targets: [startBg, startText],
            scaleX: 1,
            scaleY: 1,
            duration: 200
          });
        });

        // D√©marrer le jeu
        startBg.on('pointerdown', () => {
          startSound.play();
          this.startGame(startBg, startText);
        });

        // Animation du bouton
        this.tweens.add({
          targets: [startBg, startText],
          y: "+=10",
          duration: 1000,
          yoyo: true,
          repeat: -1,
          ease: "Sine.easeInOut"
        });

        this.startBg = startBg;
        this.startText = startText;

        // Texte pause
        this.pauseText = this.add.text(400, 300, "‚è∏ PAUSE", {
          fontSize: "64px",
          fill: "#ffffff",
          fontFamily: "Fredoka, Arial",
          fontStyle: "bold",
          stroke: "#000",
          strokeThickness: 6,
          shadow: { offsetX: 4, offsetY: 4, color: "#000", blur: 10, fill: true }
        }).setOrigin(0.5);
        this.pauseText.setDepth(200);
        this.pauseText.setVisible(false);
      }

      function update() {
        if (!gameStarted || isPaused) return;

        // Contr√¥le de direction
        if (this.cursors.left.isDown && this.playerDirection.x !== 1) {
          this.nextDirection = { x: -1, y: 0 };
        } else if (this.cursors.right.isDown && this.playerDirection.x !== -1) {
          this.nextDirection = { x: 1, y: 0 };
        } else if (this.cursors.up.isDown && this.playerDirection.y !== 1) {
          this.nextDirection = { x: 0, y: -1 };
        } else if (this.cursors.down.isDown && this.playerDirection.y !== -1) {
          this.nextDirection = { x: 0, y: 1 };
        }

        // Mouvement du serpent
        this.moveTimer += this.game.loop.delta;

        if (this.moveTimer >= 150) {
          this.moveTimer = 0;
          this.playerDirection = { ...this.nextDirection };

          const head = this.playerSnake[0];
          const newX = head.x + this.playerDirection.x * this.segmentSize;
          const newY = head.y + this.playerDirection.y * this.segmentSize;

          if (newX < 12 || newX > 788 || newY < 12 || newY > 588) {
            this.resetPlayer();
            return;
          }

          for (let i = this.playerSnake.length - 1; i > 0; i--) {
            this.playerSnake[i].x = this.playerSnake[i - 1].x;
            this.playerSnake[i].y = this.playerSnake[i - 1].y;
            if (this.playerSnake[i].shadow) {
              this.playerSnake[i].shadow.x = this.playerSnake[i].x;
              this.playerSnake[i].shadow.y = this.playerSnake[i].y + 5;
            }
          }

          head.x = newX;
          head.y = newY;
          if (head.shadow) {
            head.shadow.x = head.x;
            head.shadow.y = head.y + 5;
          }
        }

        // Collision avec pommes
        const head = this.playerSnake[0];
        this.appleGroup.getChildren().forEach((apple) => {
          if (Phaser.Geom.Intersects.RectangleToRectangle(head.getBounds(), apple.getBounds())) {
            // Son de manger
            eatSound.play();

            // Particules
            for (let i = 0; i < 8; i++) {
              const particle = this.add.circle(apple.x, apple.y, 5, 0xff3333);
              this.tweens.add({
                targets: particle,
                x: apple.x + Phaser.Math.Between(-50, 50),
                y: apple.y + Phaser.Math.Between(-50, 50),
                alpha: 0,
                duration: 500,
                onComplete: () => particle.destroy()
              });
            }

            if (apple.shadow) apple.shadow.destroy();
            if (apple.highlight) apple.highlight.destroy();
            apple.destroy();

            // Ajouter segment
            const lastSeg = this.playerSnake[this.playerSnake.length - 1];
            const segShadow = this.add.ellipse(lastSeg.x, lastSeg.y + 5, 28, 10, 0x000000, 0.3);
            segShadow.setDepth(0);

            const newSeg = this.add.rectangle(lastSeg.x, lastSeg.y, 25, 25, this.playerColor);
            newSeg.setDepth(1);
            newSeg.setStrokeStyle(2, 0xffffff, 0.5);
            newSeg.shadow = segShadow;

            this.playerSnake.push(newSeg);

            this.score += 10;
            this.scoreText.setText("Score: " + this.score);

            const progress = Math.min(this.score / 100, 1);
            this.progressBar.width = 200 * progress;

            this.tweens.add({
              targets: this.scoreText,
              scaleX: 1.3,
              scaleY: 1.3,
              duration: 100,
              yoyo: true
            });

            // Victoire
            if (this.score >= 100 && !this.winText) {
              this.showVictory();
            }
          }
        });

        // D√©placement serpents ennemis
        this.snakes.forEach((snake) => {
          for (let i = snake.length - 1; i > 0; i--) {
            snake[i].x = snake[i - 1].x;
            snake[i].y = snake[i - 1].y;
            if (snake[i].shadow) {
              snake[i].shadow.x = snake[i].x;
              snake[i].shadow.y = snake[i].y + 5;
            }
          }

          const snakeHead = snake[0];
          snakeHead.x += snake.speedX;
          snakeHead.y += snake.speedY;
          if (snakeHead.shadow) {
            snakeHead.shadow.x = snakeHead.x;
            snakeHead.shadow.y = snakeHead.y + 5;
          }

          if (snakeHead.x < 12 || snakeHead.x > 788) snake.speedX *= -1;
          if (snakeHead.y < 12 || snakeHead.y > 588) snake.speedY *= -1;

          snake.forEach((seg) => {
            if (Phaser.Geom.Intersects.RectangleToRectangle(head.getBounds(), seg.getBounds())) {
              this.resetPlayer();
            }
          });
        });
      }

      // Fonction pour d√©marrer le jeu
      Phaser.Scene.prototype.startGame = function(startBg, startText) {
        gameStarted = true;
        
        // Cacher l'√©cran de d√©marrage
        this.startOverlay.destroy();
        this.startTitle.destroy();
        startBg.destroy();
        startText.destroy();

        // Afficher les √©l√©ments du jeu
        this.playerSnake.forEach(seg => {
          seg.setVisible(true);
          if (seg.shadow) seg.shadow.setVisible(true);
        });
        
        this.scoreText.setVisible(true);
        this.progressBar.setVisible(true);
        this.progressBg.setVisible(true);
        this.pauseButton.setVisible(true);

        // Lancer la musique
        bgMusic.play();

        // Cr√©er les pommes
        this.time.addEvent({
          delay: 2000,
          callback: () => {
            if (!gameStarted || isPaused) return;
            
            const x = Phaser.Math.Between(50, 750);
            const y = Phaser.Math.Between(50, 550);

            const appleShadow = this.add.ellipse(x, y + 5, 35, 10, 0x000000, 0.3);
            appleShadow.setDepth(0);

            const apple = this.add.circle(x, y, 18, 0xff3333);
            apple.setDepth(1);
            apple.shadow = appleShadow;

            const highlight = this.add.circle(x - 5, y - 5, 6, 0xffffff, 0.7);
            highlight.setDepth(2);
            apple.highlight = highlight;

            this.appleGroup.add(apple);

            this.tweens.add({
              targets: apple,
              y: y - 10,
              duration: 5000,
              yoyo: true,
              repeat: -1,
              ease: "Sine.easeInOut"
            });

            this.tweens.add({
              targets: [apple, highlight],
              scaleX: 1.2,
              scaleY: 1.2,
              duration: 1500,
              yoyo: true,
              repeat: -1
            });

            this.time.delayedCall(5000, () => {
              appleShadow.destroy();
              highlight.destroy();
              apple.destroy();
            });
          },
          loop: true
        });

        // Cr√©er les serpents ennemis
        for (let i = 0; i < 3; i++) {
          let snake = [];
          const startX = Phaser.Math.Between(100, 700);
          const startY = Phaser.Math.Between(100, 500);
          const color = this.snakeColors[i];

          for (let j = 0; j < 5; j++) {
            const segShadow = this.add.ellipse(startX - j * 25, startY + 5, 28, 10, 0x000000, 0.3);
            segShadow.setDepth(0);

            const seg = this.add.rectangle(startX - j * 25, startY, 25, 25, color);
            seg.setDepth(1);
            seg.shadow = segShadow;
            seg.setStrokeStyle(2, 0xffffff, 0.5);

            snake.push(seg);
          }

          snake.speedX = Phaser.Math.Between(-3, 3);
          snake.speedY = Phaser.Math.Between(-3, 3);
          if (snake.speedX === 0) snake.speedX = 2;
          if (snake.speedY === 0) snake.speedY = 2;

          this.snakes.push(snake);
        }
      };

      // Fonction pause
      Phaser.Scene.prototype.togglePause = function() {
        isPaused = !isPaused;
        
        if (isPaused) {
          this.pauseText.setVisible(true);
          this.pauseButton.setText("‚ñ∂");
          bgMusic.pause();
        } else {
          this.pauseText.setVisible(false);
          this.pauseButton.setText("‚è∏");
          bgMusic.resume();
        }
      };

      // Fonction victoire
      Phaser.Scene.prototype.showVictory = function() {
        bgMusic.stop();
        
        const overlay = this.add.rectangle(400, 300, 800, 600, 0x000000, 0.7);
        overlay.setDepth(199);

        this.winText = this.add.text(400, 250, "üéâ VICTOIRE ! üéâ", {
          fontSize: "64px",
          fill: "#ffd700",
          fontFamily: "Fredoka, Arial",
          fontStyle: "bold",
          stroke: "#000",
          strokeThickness: 6,
          shadow: { offsetX: 4, offsetY: 4, color: "#000", blur: 10, fill: true }
        }).setOrigin(0.5);
        this.winText.setDepth(200);

        this.tweens.add({
          targets: this.winText,
          scaleX: 1.2,
          scaleY: 1.2,
          duration: 500,
          yoyo: true,
          repeat: -1
        });

        const buttonBg = this.add.rectangle(400, 350, 250, 70, 0x4facfe);
        buttonBg.setDepth(200);
        buttonBg.setStrokeStyle(4, 0xffffff);
        buttonBg.setInteractive({ useHandCursor: true });

        const buttonText = this.add.text(400, 350, "üîÑ Recommencer", {
          fontSize: "32px",
          fill: "#ffffff",
          fontFamily: "Fredoka, Arial",
          fontStyle: "bold"
        }).setOrigin(0.5);
        buttonText.setDepth(201);

        buttonBg.on('pointerover', () => {
          buttonBg.setFillStyle(0x00f2fe);
          this.tweens.add({
            targets: [buttonBg, buttonText],
            scaleX: 1.1,
            scaleY: 1.1,
            duration: 200
          });
        });

        buttonBg.on('pointerout', () => {
          buttonBg.setFillStyle(0x4facfe);
          this.tweens.add({
            targets: [buttonBg, buttonText],
            scaleX: 1,
            scaleY: 1,
            duration: 200
          });
        });

        buttonBg.on('pointerdown', () => {
          this.scene.restart();
          gameStarted = false;
          isPaused = false;
        });

        this.tweens.add({
          targets: [buttonBg, buttonText],
          y: "+=10",
          duration: 1000,
          yoyo: true,
          repeat: -1,
          ease: "Sine.easeInOut"
        });
      };

      // Fonction reset
      Phaser.Scene.prototype.resetPlayer = function() {
        dieSound.play();
        this.cameras.main.shake(200, 0.01);

        this.playerSnake.forEach((seg) => {
          if (seg.shadow) seg.shadow.destroy();
          seg.destroy();
        });

        this.playerSnake = [];
        for (let i = 0; i < 3; i++) {
          const segShadow = this.add.ellipse(400 - i * 25, 305, 28, 10, 0x000000, 0.3);
          segShadow.setDepth(0);

          const seg = this.add.rectangle(400 - i * 25, 300, 25, 25, this.playerColor);
          seg.setDepth(1);
          seg.setStrokeStyle(2, 0xffffff, 0.5);
          seg.shadow = segShadow;

          this.playerSnake.push(seg);
        }

        this.playerDirection = { x: 1, y: 0 };
        this.nextDirection = { x: 1, y: 0 };
        this.moveTimer = 0;

        this.score = Math.max(0, this.score - 20);
        this.scoreText.setText("Score: " + this.score);

        const progress = Math.min(this.score / 100, 1);
        this.progressBar.width = 200 * progress;

        this.playerSnake[0].setFillStyle(0xff0000);
        this.time.delayedCall(200, () => {
          this.playerSnake[0].setFillStyle(this.playerColor);
        });
      };
    </script>
  </body>
</html>